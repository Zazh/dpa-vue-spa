import{r as d,e as B,i as E,q as g,a as r,b as t,d as c,t as i,s as S,w as M,v as O,z as T,A as f,B as y,n as _,y as w,u as q,o as n,m as z}from"./index-Blph1Lc2.js";const A={class:"min-h-screen bg-gray-50 py-12"},F={class:"max-w-lg mx-auto px-4"},L={class:"text-center mb-8"},R={key:0,class:"text-gray-600 mt-2"},U={key:0,class:"bg-white rounded-2xl p-8 shadow-sm text-center"},j={key:1,class:"bg-white rounded-2xl p-8 shadow-sm"},$={class:"p-4 bg-red-50 border border-red-200 rounded-xl text-center"},G={class:"text-red-600"},H={class:"mt-6 text-center"},J={key:2,class:"bg-white rounded-2xl p-8 shadow-sm"},K={key:3,class:"bg-white rounded-2xl p-8 shadow-sm"},Q={class:"mb-6 p-4 bg-gray-50 rounded-xl"},W={class:"flex justify-between items-center"},X={class:"font-medium text-gray-900"},Y={key:0,class:"text-sm text-gray-500"},Z={class:"text-right"},ee={class:"text-xl font-bold text-gray-900"},te={class:"mb-4"},se={class:"relative"},oe={key:0,class:"mt-2 text-sm text-red-500"},ae={class:"mb-6"},le={class:"relative"},re={key:0,class:"mt-2 text-sm text-red-500"},ne={key:0,class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-xl"},ie={class:"text-sm text-red-600"},ue=["disabled"],pe={__name:"CheckoutView",setup(de){const k=q(),b=E(),{setOrderToken:C}=z(),h=d(!0),m=d(""),v=d(!1),l=d(null),a=d({email:"",phone:""}),p=d(""),o=d({email:"",phone:"",general:""});B(async()=>{const s=b.params.courseId;if(!s){m.value="Курс не указан",h.value=!1;return}try{const e=await g.getCourseInfo(s);l.value=e.data}catch(e){m.value=e.response?.data?.error||"Ошибка загрузки курса"}finally{h.value=!1}});const I=s=>{const e=s.replace(/\D/g,"");if(!e)return"";let u="+7";return e.length>1&&(u+=" ("+e.substring(1,4)),e.length>=5&&(u+=") "+e.substring(4,7)),e.length>=8&&(u+="-"+e.substring(7,9)),e.length>=10&&(u+="-"+e.substring(9,11)),u},V=s=>{let e=s.target.value.replace(/\D/g,"");e&&e[0]!=="7"&&(e="7"+e),e=e.substring(0,11),p.value=I(e),a.value.phone=e?"+"+e:"",o.value.phone&&(o.value.phone="")},D=()=>{p.value||(p.value="+7 (",a.value.phone="+7")},N=()=>{o.value={email:"",phone:"",general:""};let s=!0;return a.value.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.value.email)||(o.value.email="Введите корректный email",s=!1):(o.value.email="Email обязателен",s=!1),a.value.phone&&a.value.phone!=="+7"&&a.value.phone.replace(/\D/g,"").length!==11&&(o.value.phone="Телефон должен содержать 11 цифр",s=!1),s},P=async()=>{if(N()){v.value=!0,o.value.general="";try{const s=await g.createOrder({course_slug:b.params.courseId,email:a.value.email.toLowerCase().trim(),phone:a.value.phone||""});s.data.success&&(C(s.data.order_token),k.push({name:"Payment",params:{token:s.data.order_token}}))}catch(s){o.value.general=s.response?.data?.error||"Ошибка создания заказа"}finally{v.value=!1}}};return(s,e)=>{const u=O("router-link");return n(),r("div",A,[t("div",F,[t("div",L,[e[2]||(e[2]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Оформление заказа",-1)),l.value?(n(),r("p",R,i(l.value.course.title),1)):c("",!0)]),h.value?(n(),r("div",U,[...e[3]||(e[3]=[t("p",{class:"text-gray-600"},"Загрузка...",-1)])])):m.value?(n(),r("div",j,[t("div",$,[t("p",G,i(m.value),1)]),t("div",H,[S(u,{to:"/",class:"text-blue-600 underline"},{default:M(()=>[...e[4]||(e[4]=[w(" Вернуться на главную ",-1)])]),_:1})])])):l.value&&!l.value.is_available?(n(),r("div",J,[...e[5]||(e[5]=[t("div",{class:"p-4 bg-yellow-50 border border-yellow-200 rounded-xl text-center"},[t("p",{class:"text-yellow-700"},"Онлайн-покупка этого курса временно недоступна")],-1)])])):l.value?(n(),r("div",K,[t("div",Q,[t("div",W,[t("div",null,[t("p",X,i(l.value.course.title),1),l.value.course.duration?(n(),r("p",Y,i(l.value.course.duration),1)):c("",!0)]),t("div",Z,[t("p",ee,i(Number(l.value.price).toLocaleString())+" ₸ ",1)])])]),t("form",{onSubmit:T(P,["prevent"])},[t("div",te,[t("div",se,[f(t("input",{type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=x=>a.value.email=x),required:"",class:_(["peer w-full px-4 pt-7 pb-3 text-sm bg-gray-100 rounded-2xl border border-gray-200 focus:outline-none focus:border-gray-300 transition-all",{"border-red-500":o.value.email}]),placeholder:" "},null,2),[[y,a.value.email]]),e[6]||(e[6]=t("label",{for:"email",class:"absolute left-4 top-1/2 -translate-y-1/2 text-sm text-gray-500 peer-focus:top-4 peer-focus:text-xs peer-[:not(:placeholder-shown)]:top-4 peer-[:not(:placeholder-shown)]:text-xs transition-all pointer-events-none"},[w(" Email "),t("span",{class:"text-red-500"},"*")],-1))]),o.value.email?(n(),r("p",oe,i(o.value.email),1)):c("",!0)]),t("div",ae,[t("div",le,[f(t("input",{type:"tel",id:"phone","onUpdate:modelValue":e[1]||(e[1]=x=>p.value=x),onInput:V,onFocus:D,maxlength:"18",class:_(["peer w-full px-4 pt-7 pb-3 text-sm bg-gray-100 rounded-2xl border border-gray-200 focus:outline-none focus:border-gray-300 transition-all",{"border-red-500":o.value.phone}]),placeholder:" "},null,34),[[y,p.value]]),e[7]||(e[7]=t("label",{for:"phone",class:"absolute left-4 top-1/2 -translate-y-1/2 text-sm text-gray-500 peer-focus:top-4 peer-focus:text-xs peer-[:not(:placeholder-shown)]:top-4 peer-[:not(:placeholder-shown)]:text-xs transition-all pointer-events-none"}," Телефон ",-1))]),o.value.phone?(n(),r("p",re,i(o.value.phone),1)):c("",!0)]),o.value.general?(n(),r("div",ne,[t("p",ie,i(o.value.general),1)])):c("",!0),t("button",{type:"submit",disabled:v.value,class:"w-full py-4 bg-black text-white font-medium rounded-full hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},i(v.value?"Создание заказа...":"Перейти к оплате"),9,ue)],32),e[8]||(e[8]=t("p",{class:"mt-6 text-xs text-gray-500 text-center"}," Нажимая кнопку, вы соглашаетесь с условиями оферты ",-1))])):c("",!0)])])}}};export{pe as default};
