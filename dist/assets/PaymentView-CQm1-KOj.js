import{r as i,c as V,e as D,i as R,m as B,p as K,q as b,u as O,a as r,b as t,d as f,t as u,s as j,w as z,v as A,x as E,n as M,o,y as Q}from"./index-DIqMzke6.js";const $={class:"min-h-screen bg-gray-50 py-12"},q={class:"max-w-lg mx-auto px-4"},L={key:0,class:"bg-white rounded-2xl p-8 shadow-sm text-center"},U={key:1,class:"bg-white rounded-2xl p-8 shadow-sm"},F={class:"text-center mb-6"},G={class:"text-xl font-bold text-gray-900"},H={class:"text-center"},J={key:2,class:"bg-white rounded-2xl p-8 shadow-sm"},W={key:3,class:"bg-white rounded-2xl p-8 shadow-sm"},X={key:4,class:"bg-white rounded-2xl p-8 shadow-sm"},Y={class:"text-center mb-6"},Z={class:"text-gray-600 mt-1"},ee={class:"text-center mb-6"},te={class:"text-3xl font-bold text-gray-900"},se={class:"text-center mb-6"},ae={class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-full"},re={key:0,class:"mb-4"},oe=["href"],le={key:1,class:"mt-6 pt-6 border-t border-gray-200"},ne=["disabled"],ce={__name:"PaymentView",setup(ie){const _=O(),h=R(),{setOrderToken:k}=B(),m=i(!0),d=i(""),l=i(null),a=i("pending"),n=i(0),x=i(!1);let v=null,p=null;const w=V(()=>!1);D(async()=>{const s=h.params.token;if(!s){d.value="–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω",m.value=!1;return}k(s),await C(s)}),K(()=>{c()});const c=()=>{v&&(clearInterval(v),v=null),p&&(clearInterval(p),p=null)},C=async s=>{try{const e=await b.getPaymentData(s);if(e.data.error){e.data.status==="expired"?a.value="expired":e.data.redirect?(a.value="paid",g()):d.value=e.data.error,m.value=!1;return}l.value=e.data,n.value=e.data.time_remaining,S(s),I()}catch(e){d.value=e.response?.data?.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"}finally{m.value=!1}},S=s=>{v=setInterval(async()=>{try{const e=await b.getOrderStatus(s);e.data.status==="paid"?(c(),a.value="paid",g()):e.data.status==="expired"&&(c(),a.value="expired"),n.value=e.data.time_remaining}catch{}},5e3)},I=()=>{p=setInterval(()=>{n.value>0?n.value--:(c(),a.value="expired")},1e3)},P=s=>{const e=Math.floor(s/60),y=s%60;return`${e}:${y.toString().padStart(2,"0")}`},g=()=>{setTimeout(()=>{_.push({name:"CheckEmail"})},1500)},N=()=>{localStorage.removeItem("payment_order_token"),_.back()},T=async()=>{x.value=!0;try{await b.simulatePayment(h.params.token),c(),a.value="paid",g()}catch(s){alert(s.response?.data?.error||"–û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏")}finally{x.value=!1}};return(s,e)=>{const y=A("router-link");return o(),r("div",$,[t("div",q,[m.value?(o(),r("div",L,[...e[0]||(e[0]=[t("p",{class:"text-gray-600"},"–ó–∞–≥—Ä—É–∑–∫–∞...",-1)])])):d.value?(o(),r("div",U,[t("div",F,[e[1]||(e[1]=t("div",{class:"text-5xl mb-4"},"‚ùå",-1)),t("h1",G,u(d.value),1)]),t("div",H,[j(y,{to:"/",class:"text-blue-600 underline"},{default:z(()=>[...e[2]||(e[2]=[Q(" –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é ",-1)])]),_:1})])])):a.value==="expired"?(o(),r("div",J,[e[3]||(e[3]=t("div",{class:"text-center mb-6"},[t("div",{class:"text-5xl mb-4"},"‚è∞"),t("h1",{class:"text-xl font-bold text-gray-900"},"–í—Ä–µ–º—è –æ–ø–ª–∞—Ç—ã –∏—Å—Ç–µ–∫–ª–æ"),t("p",{class:"text-gray-600 mt-2"},"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ –∑–∞–Ω–æ–≤–æ")],-1)),t("div",{class:"text-center"},[t("button",{onClick:N,class:"px-6 py-3 bg-black text-white font-medium rounded-full hover:bg-gray-800 transition-colors"}," –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–Ω–æ–≤–æ ")])])):a.value==="paid"?(o(),r("div",W,[...e[4]||(e[4]=[t("div",{class:"text-center mb-6"},[t("div",{class:"text-5xl mb-4"},"‚úÖ"),t("h1",{class:"text-xl font-bold text-gray-900"},"–û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞!"),t("p",{class:"text-gray-600 mt-2"},"–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é...")],-1)])])):l.value?(o(),r("div",X,[t("div",Y,[e[5]||(e[5]=t("h1",{class:"text-xl font-bold text-gray-900"},"–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Kaspi",-1)),t("p",Z,u(l.value.order.course_name),1)]),t("div",ee,[t("p",te,u(Number(l.value.order.amount).toLocaleString())+" ‚Ç∏ ",1)]),t("div",se,[t("div",ae,[e[6]||(e[6]=t("span",{class:"text-gray-600"},"–û—Å—Ç–∞–ª–æ—Å—å:",-1)),t("span",{class:M(["font-mono font-bold",n.value<300?"text-red-600":"text-gray-900"])},u(P(n.value)),3)])]),e[8]||(e[8]=E('<div class="flex justify-center mb-6"><div class="p-4 bg-white border-2 border-gray-200 rounded-2xl"><div class="w-64 h-64 bg-gray-100 rounded-xl flex items-center justify-center"><div class="text-center text-gray-500"><div class="text-4xl mb-2">üì±</div><p class="text-sm">QR-–∫–æ–¥ Kaspi</p><p class="text-xs mt-1">(—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)</p></div></div></div></div><div class="text-center mb-6 text-sm text-gray-600"><p>–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Kaspi.kz</p><p>–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥</p></div>',2)),l.value.kaspi_deeplink?(o(),r("div",re,[t("a",{href:l.value.kaspi_deeplink,class:"block w-full py-4 bg-red-500 text-white font-medium rounded-full text-center hover:bg-red-600 transition-colors"}," –û—Ç–∫—Ä—ã—Ç—å Kaspi ",8,oe)])):f("",!0),w.value?(o(),r("div",le,[e[7]||(e[7]=t("p",{class:"text-xs text-gray-500 text-center mb-3"},"–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏",-1)),t("button",{onClick:T,disabled:x.value,class:"w-full py-3 bg-green-500 text-white font-medium rounded-full hover:bg-green-600 disabled:bg-gray-400 transition-colors"},u(x.value?"–û–±—Ä–∞–±–æ—Ç–∫–∞...":"‚úÖ –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É"),9,ne)])):f("",!0)])):f("",!0)])])}}};export{ce as default};
